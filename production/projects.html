<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Meetkey</title>

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../build/css/custom.css" rel="stylesheet">
  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col menu_fixed">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <a href="index.html" class="site_title ">
                <div class="row">
                  <div class="col-xs-3">
                    <img src="images/MeetKey_logo3.png" alt="..." class="" style="max-width: 100%; max-height: 100%">
                  </div>
                  <div class="col-xs-8">
                    <img src="images/MeetKey_text.png" alt="..." style="max-width: 100%; max-height: 100%">
                    <!-- <span>Meetkey</span> -->
                  </div>
                  <div class="col-xs-1">
                  </div>
                </div>
              </a>
            </div>

            <div class="clearfix"></div>

            <!-- menu profile quick info -->
          <div class="profile clearfix">
            <div class="profile_pic">
              <img src="images/user.png" alt="..." class="img-circle profile_img" id="menu_img">
            </div>
            <div class="profile_info">
              <span id="menu_info"></span>
              <h2 id="menu_name"></h2>
            </div>
          </div>
          <!-- /menu profile quick info -->

          <br />

          <!-- sidebar menu -->
          <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
            <div class="menu_section">
              <!-- <h3>General</h3> -->
              <ul class="nav side-menu">
                <li><a href="index.html"><i class="fa fa-home"></i> Dashboard </a>
                </li>
                <li><a><i class="fa fa-bar-chart-o"></i> 회의 분석 <span class="fa fa-chevron-down"></span></a>
                  <ul class="nav child_menu">
                    <li><a href="echarts.html">지난 회의 결과</a></li>
                    <li><a href="projects.html">회의록 리스트</a></li>
                  </ul>
                </li>
                <li><a><i class="fa fa-edit"></i> 회의 관리 <span class="fa fa-chevron-down"></span></a>
                  <ul class="nav child_menu">
                    <li><a href="form.html">회의 만들기</a></li>
                    <li><a href="tables_dynamic.html">회의 예약리스트</a></li>
                    <li><a href="project_detail.html">회의 중(임시)</a></li>
                  </ul>
                </li>
                <li><a href="tables.html"><i class="fa fa-group"></i> 친구 관리 </a>
                </li>
                <li><a href="calendar.html"><i class="fa fa-calendar"></i> 일정 관리 </a>
                </li>
                <li><a href="profile.html"><i class="fa fa-cog"></i> 개인 설정 </a>
                </li>
              </ul>
            </div>

          </div>
          <!-- /sidebar menu -->

        </div>
      </div>

      <!-- top navigation -->
      <div class="top_nav">
        <div class="nav_menu">
          <nav>
            <div class="nav toggle">
              <a id="menu_toggle"><i class="fa fa-bars"></i></a>
            </div>

            <ul class="nav navbar-nav navbar-right">
              <li class="">
                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                  <img src="images/user.png" id="bar_img"><span id="bar_name">황채원</span>
                  <span class=" fa fa-angle-down"></span>
                </a>
                <ul class="dropdown-menu dropdown-usermenu pull-right">
                  <li><a href="javascript:;"> Profile</a></li>
                  <li>
                    <a href="javascript:;">
                      <span class="badge bg-red pull-right">50%</span>
                      <span>Settings</span>
                    </a>
                  </li>
                  <li><a href="javascript:;">Help</a></li>
                  <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>회의록 리스트 </h3>
              </div>
            </div>

            <div class="clearfix"></div>

            <div class="row">
              <div class="col-md-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h4><i class="fa fa-file"></i> 전체 회의록</h4>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">

                    <!-- 회의록 테이블 // 회의 기본 정보 -->
                    <table class="table table-striped table-hover projects">
                      <thead>
                        <tr>
                          <th style="width: 20%">회의 주제</th><!--회의 주제-->
                          <th style="width: 20%">회의 일시</th><!--회의 날짜+회의시간-->
                          <th>회의 참여자</th><!--회의 참여자-->
                          <th>전체 회의 내용</th>
                          <th style="width: 20%">전체 스크립트</th>
                        </tr>
                      </thead>
                      <tbody id="table_body">

                      </tbody>
                    </table>
                    <!-- end 전체 회의록 -->

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
          <div class="pull-right">
            Copyright &copy; 2018 Meetkey. All rights reserved.
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- bootstrap-progressbar -->
    <script src="../vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <!-- DateJS -->
    <script src="../vendors/DateJS/build/date.js"></script>

    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>
    <script src="./js/cookie.js"></script>

    <script>
      // 쿠키없으면 그냥 1로 설정
      var unum = getCookie('unum')? getCookie('unum'): 1;

      $(document).ready(function(){
        printMyInfo();
        printBookedMeetingList();
      });

      function printBookedMeetingList() {

        var settings = {
          crossDomain: true,
          url: "https://kz2hltyjb2.execute-api.ap-northeast-2.amazonaws.com/test/meet/info?unum="+unum+"&done=true",
          type: "GET",
          contentType: "application/json"
        }

        $.ajax(settings)
          .done(function (response) {
            if('message' in response) {
              alert(response.message)
            } else {
              console.log(response);
              // data = [{"member":{}, "_id":string, "mname":string, "date":date+time, "where":string, "made":unum, "memo":string}]
              var data = response.data;
              var meetTable = $('#table_body');
              for(var i=0;i<data.length;i++){
                var member = data[i].member_raw;
                var list_inline = ""
                for(var j=0;j<member.length;j++){
                  list_inline += `
                    <li>${data[i].member[member[j]].uname}
                      <!-- <img src="images/user.png" class="avatar" alt="Avatar"> -->
                    </li>
                  `
                }
                var date = new Date(data[i].date).addHours(-9).addMonths(1);
                var tr = `
                  <tr>
                    <td>${data[i].mname}</td>
                    <td>
                      <small>${date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate()+" "+date.getHours()+":"+date.getMinutes()}</small>
                    </td>
                    <td>
                      <ul class="list-inline">
                        ${list_inline}
                      </ul>
                    </td>
                    <td>
                      <a href="echarts.html?mid=${data[i]["_id"]}">확인하기</a><!--해당 회의에 맞는 채팅 페이지로 동적 이동-->
                    </td>
                    <td>
                      <a href='chat.html?mid=${data[i]["_id"]}'>
                        <i class="fa fa-file-text-o"></i>
                        ${data[i].mname}<!--전체 텍스트 파일 이름.형식-->
                      </a>
                    </td>
                  </tr>
                `
                meetTable.append(tr);
              }
            }
          })
          .fail(function () {
            alert('fail');
          });
      }

      function startMeeting(mid, isMade){
        alert(mid);
        if(!isMade) {
          window.location.replace("project_detail.html?mid="+mid);
        } else {
        var settings = {
          crossDomain: true,
          url: "https://kz2hltyjb2.execute-api.ap-northeast-2.amazonaws.com/test/meet/start?mid="+mid,
          type: "GET",
          contentType: "application/json"
        }

        $.ajax(settings)
          .done(function (response) {
            window.location.replace("project_detail.html?mid="+mid);
          })
          .fail(function () {
            alert('fail');
          });
        }
      }
    </script>

  </body>
</html>
